<navigation-bar title="日志" back="{{true}}" bind:back="goBack" home-button="{{false}}" background="{{themeNavBg}}" color="{{themeNavText}}" />

<view class="page theme-root {{themeClass}}">
  <view class="hero-card">
    <view class="hero-title" wx:if="{{targetType === 'space'}}">房间 {{space.code || space.space_id}}@{{space.owner || '未设置'}}</view>
    <view class="hero-title" wx:if="{{targetType === 'user'}}">用户 {{user.alias || user.user_id || '未知用户'}}</view>
    <view class="hero-sub">{{filterLabel}}</view>
  </view>

  <view class="filter-card">
    <picker mode="selector" range="{{spaceOptions}}" value="{{spaceOptionIndex}}" bindchange="onSpaceOptionChange" wx:if="{{targetType === 'user'}}">
      <view class="filter-item full">
        <text class="filter-label">房间号</text>
        <text class="filter-value">{{spaceOptions[spaceOptionIndex] || '全部房间'}}</text>
      </view>
    </picker>
    <picker mode="date" value="{{startDate}}" bindchange="onStartDateChange">
      <view class="filter-item">
        <text class="filter-label">开始</text>
        <text class="filter-value">{{startDate || '不限'}}</text>
      </view>
    </picker>
    <picker mode="date" value="{{endDate}}" bindchange="onEndDateChange">
      <view class="filter-item">
        <text class="filter-label">结束</text>
        <text class="filter-value">{{endDate || '不限'}}</text>
      </view>
    </picker>
    <view class="filter-actions">
      <button size="mini" class="ghost" bindtap="resetFilter">重置</button>
      <button size="mini" class="primary" bindtap="applyFilter">筛选</button>
    </view>
  </view>

  <view class="list-card">
    <view class="log-row {{item.action_level}} {{item.is_page_view ? 'view' : ''}}" wx:for="{{logEntries}}" wx:key="id">
      <view class="log-head">
        <text class="log-user">{{item.alias || item.user_id || '未知用户'}}</text>
        <view class="log-action-tag {{item.action_level}}">{{item.action_label || item.action}}</view>
      </view>
      <view class="log-meta">
        <text class="log-page {{item.is_page_view ? 'muted' : ''}}">{{item.page || '-'}}</text>
        <text>{{item.created_at_bj}}</text>
      </view>
      <view class="log-content" wx:if="{{item.content_preview && !item.is_page_view}}">
        <text class="log-content-label">内容</text>
        <text class="log-content-text">{{item.content_preview}}</text>
      </view>
      <view class="log-detail" wx:if="{{item.detail_text && !item.is_page_view}}">{{item.detail_text}}</view>
    </view>
    <view class="empty" wx:if="{{loading}}">加载中...</view>
    <view class="empty" wx:if="{{!loading && !logEntries.length}}">暂无日志</view>
    <view class="empty" wx:if="{{loadingMore}}">加载更多...</view>
    <view class="empty" wx:if="{{!loading && !loadingMore && !hasMore && logEntries.length}}">没有更多了</view>
  </view>
</view>
