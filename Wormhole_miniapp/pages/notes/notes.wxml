<navigation-bar title="动态" back="{{false}}" home-button="{{true}}" bind:home="goHome" background="#FFFFFF" color="#0F172A" />
<view class="notes-container">
  <skeleton-list show="{{loading}}" rows="6" />
  <view class="notes-list" wx:if="{{!loading}}">
    <view wx:for="{{posts}}" wx:key="id" class="post card">
      <view class="post-header">
        <view class="post-info">
          <image class="avatar" src="/assets/icons/chat.png"></image>
          <view class="user-info">
            <view class="name">{{item.alias || item.user_id || '匿名'}}</view>
            <view class="time muted">{{item.created_at}}</view>
          </view>
        </view>
        <view class="post-actions" wx:if="{{item.user_id === myUserId || isOwner}}">
          <button size="mini" class="ghost" data-id="{{item.id}}" bindtap="deletePost">删除</button>
        </view>
      </view>
      <view wx:if="{{item.content}}" class="post-content">{{item.content}}</view>
      <view wx:if="{{item.media_type==='image'}}" class="images">
        <image wx:for="{{item.media_urls}}" wx:for-item="imgSrc" wx:key="*this" class="image" mode="aspectFill" src="{{imgSrc}}" data-urls="{{item.media_urls}}" data-current="{{imgSrc}}" bindtap="previewImage" />
      </view>
      <video wx:if="{{item.media_type==='video'}}" class="video" src="{{item.media_urls[0]}}" controls></video>

      <view class="comments" wx:if="{{item.comments && item.comments.length}}">
        <view class="comment" wx:for="{{item.comments}}" wx:key="id">
          <view class="comment-header">
            <text class="comment-name">{{item.alias || item.user_id || '匿名'}}</text>
            <text class="comment-time muted">{{item.created_at}}</text>
          </view>
          <view class="comment-content">{{item.content}}</view>
        </view>
      </view>

      <view class="comment-box">
        <input class="comment-input" placeholder="评论..." value="{{commentInputs[item.id]}}" data-id="{{item.id}}" bindinput="onCommentInput" />
        <button class="btn btn-primary" size="mini" data-id="{{item.id}}" bindtap="submitComment">发送</button>
      </view>
    </view>
    <empty wx:if="{{!posts.length}}" text="暂无动态，点击下方 + 发布" />
  </view>

  <view class="add-button" bindtap="createPost">
    <text class="add-icon">+</text>
  </view>
</view> 
