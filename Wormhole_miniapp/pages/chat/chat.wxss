page { overflow: hidden; }
.chat-container {
  display: flex;
  flex-direction: column;
  min-height: calc(100vh - 44px - constant(safe-area-inset-top));
  min-height: calc(100vh - 44px - env(safe-area-inset-top));
  height: calc(100vh - 44px - constant(safe-area-inset-top));
  height: calc(100vh - 44px - env(safe-area-inset-top));
  background: var(--bg);
  color: var(--text);
}
.nav-chips { display: flex; align-items: center; gap: 12rpx; }
.nav-chip { padding: 8rpx 14rpx; border-radius: 999rpx; background: var(--chip); color: var(--text); font-size: 22rpx; }
.nav-chip.online { background: rgba(20, 184, 166, 0.2); color: var(--primary-strong); }
/* 保证消息只在内部滚动，输入区固定在底部 */
.message-list { flex: 1; padding: 20rpx; height: calc(100vh - 120rpx); box-sizing: border-box; }
.history-hint { text-align: center; font-size: 22rpx; color: var(--text-muted); padding: 12rpx 0 20rpx; }
.unread-divider { display: flex; align-items: center; justify-content: center; margin: 6rpx 0 16rpx; color: var(--text-muted); font-size: 22rpx; }
.unread-divider text { background: var(--panel); padding: 6rpx 16rpx; border-radius: 999rpx; }
.message-item { display: flex; margin-bottom: 24rpx; }
.message-item.self { flex-direction: row-reverse; }
.avatar {
  width: 72rpx;
  height: 72rpx;
  border-radius: 50%;
  margin: 0 16rpx;
  background: linear-gradient(135deg, var(--accent-teal), var(--accent-cyan));
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  color: #0F172A;
  overflow: hidden;
}
.avatar image { width: 100%; height: 100%; object-fit: cover; }
.message-content { max-width: 70%; }
.nickname { font-size: 24rpx; color: var(--text-muted); margin-bottom: 6rpx; }
.message-item.self .nickname { text-align: right; }
.reply-snippet { background: var(--panel); border-left: 4rpx solid var(--border); padding: 8rpx 12rpx; border-radius: 10rpx; margin-bottom: 8rpx; font-size: 22rpx; color: var(--text-muted); }
.reply-snippet-name { font-weight: 600; margin-right: 8rpx; color: var(--text); }
.reply-snippet-text { color: var(--text-muted); }
.message-bubble { background: var(--bubble); padding: 16rpx 20rpx; border-radius: 16rpx; word-break: break-word; border: none; color: var(--text); box-shadow: var(--shadow-soft); }
.self .message-bubble { background: var(--bubble-self); color: var(--text); }
.message-image { width: 360rpx; max-width: 60vw; border-radius: 16rpx; margin: 8rpx 0; }
.message-video { width: 360rpx; max-width: 60vw; border-radius: 16rpx; margin: 8rpx 0; background: #000000; }
.live-message {
  width: 360rpx;
  max-width: 60vw;
  height: 360rpx;
  border-radius: 16rpx;
  margin: 8rpx 0;
  overflow: hidden;
  position: relative;
  background: #0f172a;
}
.live-cover {
  width: 100%;
  height: 100%;
}
.live-mask {
  position: absolute;
  inset: 0;
  background: linear-gradient(to top, rgba(15, 23, 42, 0.4), rgba(15, 23, 42, 0.08));
  display: flex;
  align-items: center;
  justify-content: center;
}
.live-play {
  width: 0;
  height: 0;
  border-top: 16rpx solid transparent;
  border-bottom: 16rpx solid transparent;
  border-left: 22rpx solid #ffffff;
  margin-left: 6rpx;
  filter: drop-shadow(0 2rpx 6rpx rgba(0, 0, 0, 0.3));
}
.live-badge {
  position: absolute;
  right: 10rpx;
  top: 10rpx;
  background: rgba(15, 23, 42, 0.68);
  color: #ffffff;
  font-size: 20rpx;
  padding: 4rpx 10rpx;
  border-radius: 999rpx;
}
.audio-bubble { display: inline-flex; align-items: center; gap: 12rpx; padding: 16rpx 20rpx; border-radius: 999rpx; background: var(--panel); color: var(--text); margin: 8rpx 0; }
.audio-bubble .audio-icon { font-size: 28rpx; }
.audio-bubble .playing { font-size: 22rpx; color: var(--primary-strong); }
.message-meta { display: flex; align-items: center; gap: 12rpx; margin-top: 6rpx; }
.message-item.self .message-meta { justify-content: flex-end; }
.message-time { font-size: 22rpx; color: var(--text-muted); }
.read-state { font-size: 22rpx; color: var(--text-muted); }
.sending-spinner {
  width: 22rpx;
  height: 22rpx;
  border-radius: 50%;
  border: 2rpx solid var(--border);
  border-top-color: transparent;
  animation: spin 0.9s linear infinite;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}
.typing-row { display: flex; align-items: center; gap: 12rpx; padding: 8rpx 0 16rpx; }
.typing-avatars { display: flex; gap: 8rpx; }
.typing-avatar { width: 52rpx; height: 52rpx; border-radius: 50%; background: var(--bg-secondary); display: flex; align-items: center; justify-content: center; overflow: hidden; color: var(--text); font-size: 22rpx; }
.typing-avatar image { width: 100%; height: 100%; }
.typing-text { font-size: 22rpx; color: var(--text-muted); }
.input-area { position: fixed; left: 0; right: 0; bottom: 0; padding: 16rpx; background: var(--surface); border-top: 1rpx solid var(--border); display: flex; flex-direction: column; gap: 16rpx; }
.reply-bar { display: flex; align-items: center; justify-content: space-between; background: var(--panel); border: 1rpx solid var(--border); border-radius: 12rpx; padding: 10rpx 16rpx; font-size: 22rpx; color: var(--text-muted); }
.reply-text { flex: 1; margin-right: 12rpx; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.reply-cancel { width: 40rpx; height: 40rpx; line-height: 40rpx; text-align: center; border-radius: 50%; background: var(--bg-secondary); color: var(--text); }
.input-row { display: flex; gap: 12rpx; align-items: center; }
.message-input { flex: 1; height: 72rpx; background: var(--input); border: 1rpx solid var(--border); border-radius: 12rpx; padding: 0 24rpx; color: var(--text); }
.send-button { width: 120rpx; height: 72rpx; line-height: 72rpx; background: linear-gradient(135deg, var(--accent-teal), var(--accent-cyan)); color: #0F172A; border-radius: 12rpx; font-size: 28rpx; }
.emoji-button { width: 72rpx; height: 72rpx; background: var(--bg-secondary); border-radius: 12rpx; border: 1rpx solid var(--border); display: flex; align-items: center; justify-content: center; padding: 0; margin: 0; }
.plus-button { width: 72rpx; height: 72rpx; background: var(--bg-secondary); border-radius: 12rpx; border: 1rpx solid var(--border); display: flex; align-items: center; justify-content: center; padding: 0; margin: 0; }
.tool-btn { width: 72rpx; height: 72rpx; border: 1rpx solid var(--border); background: var(--surface); border-radius: 16rpx; display: flex; align-items: center; justify-content: center; padding: 0; margin: 0; }
.emoji-button::after, .plus-button::after, .tool-btn::after { border: none; }

.icon { width: 28rpx; height: 28rpx; position: relative; }
.icon.mic .mic-head {
  position: absolute;
  top: 2rpx;
  left: 50%;
  width: 14rpx;
  height: 16rpx;
  border: 2rpx solid var(--text);
  border-radius: 10rpx;
  transform: translateX(-50%);
}
.icon.mic .mic-stand {
  position: absolute;
  top: 18rpx;
  left: 50%;
  width: 2rpx;
  height: 8rpx;
  background: var(--text);
  transform: translateX(-50%);
}
.icon.mic .mic-base {
  position: absolute;
  bottom: 2rpx;
  left: 50%;
  width: 12rpx;
  height: 2rpx;
  background: var(--text);
  transform: translateX(-50%);
}

.icon.keyboard .kb-body {
  position: absolute;
  inset: 2rpx;
  border: 2rpx solid var(--text);
  border-radius: 6rpx;
}
.icon.keyboard .kb-row {
  position: absolute;
  left: 6rpx;
  right: 6rpx;
  height: 2rpx;
  background: var(--text);
  top: 10rpx;
}
.icon.keyboard .kb-row.bottom {
  top: 16rpx;
  left: 9rpx;
  right: 9rpx;
}

.icon.emoji {
  width: 26rpx;
  height: 26rpx;
  border: 2rpx solid var(--text);
  border-radius: 50%;
}
.icon.emoji .emoji-eye {
  position: absolute;
  top: 7rpx;
  width: 4rpx;
  height: 4rpx;
  background: var(--text);
  border-radius: 50%;
}
.icon.emoji .emoji-eye.left { left: 7rpx; }
.icon.emoji .emoji-eye.right { right: 7rpx; }
.icon.emoji .emoji-mouth {
  position: absolute;
  left: 50%;
  bottom: 5rpx;
  width: 12rpx;
  height: 6rpx;
  border: 2rpx solid var(--text);
  border-top: none;
  border-left: none;
  border-right: none;
  border-radius: 0 0 10rpx 10rpx;
  transform: translateX(-50%);
}

.icon.plus .plus-h,
.icon.plus .plus-v {
  position: absolute;
  background: var(--text);
}
.icon.plus .plus-h {
  top: 50%;
  left: 0;
  right: 0;
  height: 2rpx;
  transform: translateY(-50%);
}
.icon.plus .plus-v {
  left: 50%;
  top: 0;
  bottom: 0;
  width: 2rpx;
  transform: translateX(-50%);
}
.voice-button { flex: 1; height: 72rpx; line-height: 72rpx; text-align: center; border-radius: 16rpx; background: var(--bg-secondary); border: 1rpx dashed var(--border); color: var(--text); }
.voice-button:active { background: var(--bubble-self); border-color: var(--primary-strong); }
.emoji-panel { margin-top: 12rpx; background: transparent; border-radius: 16rpx; border: 1rpx solid var(--border); height: 380rpx; overflow: hidden; }
.emoji-scroll { height: 100%; padding: 16rpx; box-sizing: border-box; }
.emoji-grid { display: flex; flex-wrap: wrap; gap: 12rpx; }
.emoji-item { width: 64rpx; height: 64rpx; border-radius: 12rpx; background-color: transparent; border: 1rpx solid var(--border); display: flex; align-items: center; justify-content: center; }
.emoji-item-inner { display: inline-block; }
.emoji-item-sprite { display: block; }
.plus-panel { margin-top: 12rpx; background: var(--panel); border-radius: 16rpx; padding: 20rpx 16rpx; border: 1rpx solid var(--border); }
.plus-grid { display: flex; flex-wrap: wrap; gap: 18rpx; }
.plus-item { width: 120rpx; display: flex; flex-direction: column; align-items: center; gap: 10rpx; padding: 10rpx 6rpx; border-radius: 16rpx; background: var(--surface); border: 1rpx solid var(--border); }
.plus-icon { width: 64rpx; height: 64rpx; line-height: 64rpx; text-align: center; font-size: 34rpx; background: var(--bg-secondary); border-radius: 18rpx; }
.plus-label { font-size: 22rpx; color: var(--text-muted); text-align: center; }
.modal-mask { position: fixed; left: 0; right: 0; top: 0; bottom: 0; background: rgba(15,23,42,0.45); display: flex; align-items: center; justify-content: center; z-index: 200; }
.modal-card { width: 80vw; max-height: 70vh; background: var(--surface); border-radius: 24rpx; padding: 24rpx; box-shadow: var(--shadow-strong); }
.modal-title { font-size: 28rpx; font-weight: 600; color: var(--text); margin-bottom: 16rpx; }
.modal-list { max-height: 50vh; }
.modal-item { display: flex; align-items: center; gap: 12rpx; padding: 8rpx 0; }
.modal-avatar { width: 56rpx; height: 56rpx; border-radius: 50%; background: var(--bg-secondary); display: flex; align-items: center; justify-content: center; overflow: hidden; color: var(--text); font-size: 24rpx; }
.modal-avatar image { width: 100%; height: 100%; }
.modal-name { font-size: 24rpx; color: var(--text); }
.modal-empty { text-align: center; color: var(--text-muted); font-size: 22rpx; padding: 12rpx 0; }
